{
  "hash": "7a2bb03545f799ec4246845e5200a406",
  "result": {
    "markdown": "---\ntitle: \"ANOVA in 4 steps\"\nauthor: \n    -name: \"Sith Jaisong\"\ncategories: [R, ANOVA]\ndraft: true\n---\n\n\n# เกริ่น\nคนข้าง ๆ ตัวผม หลายคน ถามเรื่องการวิเคราะห์ ANOVA โดย โปรแกรม R ผมจะไม่อถิบายว่า ANOVA คืออะไร เพราะว่าถ้าถามแล้วแสดงว่า อยากจะวิเคราะห์ บางที ไม่รู้อะไร ก็ วิเคราะห์ ANOVA ไว้ก่อน โดยไม่สนอะไร เอาเป็นว่า สอนง่าย ๆ เลย  มี 4 ขั้นตอน ดังนี้\n\n1. สร้าง ANOVA object\n\nสร้าง ANOVA object ก่อน โดยใช้ฟังก์ชัน `aov()` ในฟังก์ชัน `aov()` ให้ระบุตัวแปรอิสระและตัวแปรตามด้วยสูตรที่มีรูปแบบ y ~ x1 + x2 โดยที่ y เป็นตัวแปรตาม และ x1, x2 … เป็นตัวแปรอิสระหนึ่งตัวห\nรือมากกว่า\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Create an aov object\nmod.aov <- aov(formula = y ~ x1 + x2 + ...,\n               data = data)\n```\n:::\n\n2. สร้างตาราง ANOVA  \n\nสร้างตาราง ANOVA สรุปโดยใช้ฟังก์ชัน `summary()` กับ ANOVA object (ในที่นี่คือ mod.aov) ที่สร้างขึ้นในขั้นตอนที่ 1\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 2: Look at a summary of the aov object\nsummary(mod.aov)\n```\n:::\n\n\n3. การทดสอบ post-hoc หากจำเป็น\n\nหากจำเป็น ให้ทดสอบ post-hoc โดยใช้ฟังก์ชัน post-hoc test เช่น `TukeyHSD()` กับ ANOVA object ที่คุณสร้างในขั้นตอนที่ 1\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 3: Calculate post-hoc tests\nTukeyHSD(mod.aov)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\nHSD.test(mod.aov, \"Y\", group = TRUE, console = TRUE)\n```\n:::\n\n\n4. แปลความลักษณะของความแตกต่างของกลุ่มทดสอบ (หากจำเป็น)\n้\nตีความลักษณะของความแตกต่างของกลุ่ม โดยการสร้าง การถดถอยเชิงเส้นโดยใช้ `lm()` แทน `aov()` ในขั้นตอนที่ 1\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 4: Look at coefficients\nmod.lm <- lm(formula = y ~ x1 + x2 + ...,\n             data = data)\n\nsummary(mod.lm)\n```\n:::\n\n5. ข้อนี้ผมอยากให้ทำ เพื่อ ตรวจ assumption ด้วย independence, homogeneity of variance และ Residuals vs fitted Values\n\nถ้าอยากอ่านหรือทำความเข้าใจเกี่ยวกับ ANOVA มากขึ้น อยากแนะนำให้อ่าน [ANOVA Cookbook](https://benwhalley.github.io/just-enough-r/anova-cookbook.html#howell-factorial-example) จะเห็นอะไรที่น่าสนใจ\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# setting page \nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(patchwork)\nlibrary(ggthemes)\nlibrary(rmarkdown)\ntheme_set(theme_few())\nknitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)\noptions(digits = 3)\n```\n:::\n\n\n# ตัวอย่าง`InsectSprays`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"InsectSprays\")\npaged_table(InsectSprays)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"count\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"spray\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"10\",\"2\":\"A\"},{\"1\":\"7\",\"2\":\"A\"},{\"1\":\"20\",\"2\":\"A\"},{\"1\":\"14\",\"2\":\"A\"},{\"1\":\"14\",\"2\":\"A\"},{\"1\":\"12\",\"2\":\"A\"},{\"1\":\"10\",\"2\":\"A\"},{\"1\":\"23\",\"2\":\"A\"},{\"1\":\"17\",\"2\":\"A\"},{\"1\":\"20\",\"2\":\"A\"},{\"1\":\"14\",\"2\":\"A\"},{\"1\":\"13\",\"2\":\"A\"},{\"1\":\"11\",\"2\":\"B\"},{\"1\":\"17\",\"2\":\"B\"},{\"1\":\"21\",\"2\":\"B\"},{\"1\":\"11\",\"2\":\"B\"},{\"1\":\"16\",\"2\":\"B\"},{\"1\":\"14\",\"2\":\"B\"},{\"1\":\"17\",\"2\":\"B\"},{\"1\":\"17\",\"2\":\"B\"},{\"1\":\"19\",\"2\":\"B\"},{\"1\":\"21\",\"2\":\"B\"},{\"1\":\"7\",\"2\":\"B\"},{\"1\":\"13\",\"2\":\"B\"},{\"1\":\"0\",\"2\":\"C\"},{\"1\":\"1\",\"2\":\"C\"},{\"1\":\"7\",\"2\":\"C\"},{\"1\":\"2\",\"2\":\"C\"},{\"1\":\"3\",\"2\":\"C\"},{\"1\":\"1\",\"2\":\"C\"},{\"1\":\"2\",\"2\":\"C\"},{\"1\":\"1\",\"2\":\"C\"},{\"1\":\"3\",\"2\":\"C\"},{\"1\":\"0\",\"2\":\"C\"},{\"1\":\"1\",\"2\":\"C\"},{\"1\":\"4\",\"2\":\"C\"},{\"1\":\"3\",\"2\":\"D\"},{\"1\":\"5\",\"2\":\"D\"},{\"1\":\"12\",\"2\":\"D\"},{\"1\":\"6\",\"2\":\"D\"},{\"1\":\"4\",\"2\":\"D\"},{\"1\":\"3\",\"2\":\"D\"},{\"1\":\"5\",\"2\":\"D\"},{\"1\":\"5\",\"2\":\"D\"},{\"1\":\"5\",\"2\":\"D\"},{\"1\":\"5\",\"2\":\"D\"},{\"1\":\"2\",\"2\":\"D\"},{\"1\":\"4\",\"2\":\"D\"},{\"1\":\"3\",\"2\":\"E\"},{\"1\":\"5\",\"2\":\"E\"},{\"1\":\"3\",\"2\":\"E\"},{\"1\":\"5\",\"2\":\"E\"},{\"1\":\"3\",\"2\":\"E\"},{\"1\":\"6\",\"2\":\"E\"},{\"1\":\"1\",\"2\":\"E\"},{\"1\":\"1\",\"2\":\"E\"},{\"1\":\"3\",\"2\":\"E\"},{\"1\":\"2\",\"2\":\"E\"},{\"1\":\"6\",\"2\":\"E\"},{\"1\":\"4\",\"2\":\"E\"},{\"1\":\"11\",\"2\":\"F\"},{\"1\":\"9\",\"2\":\"F\"},{\"1\":\"15\",\"2\":\"F\"},{\"1\":\"22\",\"2\":\"F\"},{\"1\":\"15\",\"2\":\"F\"},{\"1\":\"16\",\"2\":\"F\"},{\"1\":\"13\",\"2\":\"F\"},{\"1\":\"10\",\"2\":\"F\"},{\"1\":\"26\",\"2\":\"F\"},{\"1\":\"26\",\"2\":\"F\"},{\"1\":\"24\",\"2\":\"F\"},{\"1\":\"13\",\"2\":\"F\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = InsectSprays, aes(x = spray, y = count)) + geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# step 1\nmod.aov <- aov(formula = count ~ spray, data = InsectSprays)\nmod.aov\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\n   aov(formula = count ~ spray, data = InsectSprays)\n\nTerms:\n                spray Residuals\nSum of Squares   2669      1015\nDeg. of Freedom     5        66\n\nResidual standard error: 3.92\nEstimated effects may be unbalanced\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# step 2\nsummary(mod.aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Df Sum Sq Mean Sq F value Pr(>F)    \nspray        5   2669     534    34.7 <2e-16 ***\nResiduals   66   1015      15                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# step 3\nTukeyHSD(mod.aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = count ~ spray, data = InsectSprays)\n\n$spray\n       diff    lwr   upr p adj\nB-A   0.833  -3.87  5.53 0.995\nC-A -12.417 -17.12 -7.72 0.000\nD-A  -9.583 -14.28 -4.88 0.000\nE-A -11.000 -15.70 -6.30 0.000\nF-A   2.167  -2.53  6.87 0.754\nC-B -13.250 -17.95 -8.55 0.000\nD-B -10.417 -15.12 -5.72 0.000\nE-B -11.833 -16.53 -7.13 0.000\nF-B   1.333  -3.37  6.03 0.960\nD-C   2.833  -1.87  7.53 0.492\nE-C   1.417  -3.28  6.12 0.949\nF-C  14.583   9.88 19.28 0.000\nE-D  -1.417  -6.12  3.28 0.949\nF-D  11.750   7.05 16.45 0.000\nF-E  13.167   8.47 17.87 0.000\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\nout <- HSD.test(mod.aov, \"spray\")\nout$groups\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  count groups\nF 16.67      a\nB 15.33      a\nA 14.50      a\nD  4.92      b\nE  3.50      b\nC  2.08      b\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# step 4\nmod.lm <- lm(formula = count ~ spray, data = InsectSprays)\nmod.lm\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = count ~ spray, data = InsectSprays)\n\nCoefficients:\n(Intercept)       sprayB       sprayC       sprayD       sprayE       sprayF  \n     14.500        0.833      -12.417       -9.583      -11.000        2.167  \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# step 5 แถมให้เพื่อตรวจ assumptions\nlibrary(performance)\ncheck_model(mod.aov)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}