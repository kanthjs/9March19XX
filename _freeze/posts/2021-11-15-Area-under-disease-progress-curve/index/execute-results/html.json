{
  "hash": "8816cd10dace665f445af223ef8f5d8c",
  "result": {
    "markdown": "---\ntitle: \"Area Under Disease progress Curve\"\nauthor: \"Sith Jaisong\"\ndate: '2021-11-15'\ncategories: [R, PDE]\ndraft: TRUE\n---\n\n\n# AUDPC คือ อะไร\nพื้นที่ใต้กราฟกาพัฒนาของโรค (Area Under Disease progress Curve: AUDPC) ต่อจากนี้จะ พูดสั้น ๆ ว่า **พื้นที่ใต้กราฟ** หรือ **AUDPC** เป็นข้อมูลสรุปเชิงปริมาณ (ข้อย้ำว่าเป็นข้อมูลสรุป เพราะว่า  1  กราฟ มีแค่ค่าเดียว) ใช้เพื่อบ่งปริมาณของความรุนแรงของโรคในช่วงเวลาหนึ่งเพื่อเปรียบเทียบ ช่วงเวลาหนึ่ง ๆ เช่น ฤดู ปี สถานที่ หรือ วิธีการจัดการ\n\n วิธีการที่ใช้บ่อยที่สุดในการประมาณค่า AUDPC คือการแยกคิดพื้นที่ใต้กราฟเป็นช่วง ๆ ซึ่งสามารถพิจารณาจุดเวลาในลำดับ $$t_{i}$$ โดยที่ช่วงเวลาระหว่างจุดเวลาสองจุดอาจสอดคล้องกันหรืออาจแตกต่างกันไป ที่ค่าความเกิดหรือความรุนแรงของโรคที่เวลาหนึ่ง ๆ  $y_{i}$ เรากำหนด ความรุนแรงของโรคที่เวลา 0  กำหนด $$y_{0}$$ ที่เวลา $$t_{0}$$ ซึ่งคือ การสังเกตความรุนแรงของโรคครั้งแรกในการศึกษาของเรา A (tk) AUDPC ที่ $$t = t_{k}$$ คือค่าการสะสมของโรคทั้่งหมดจนถึงเวลา $$t_{k}$$ ที่กำหนด โดยตามสูตรคณิตศาสตร์\n ![](https://www.apsnet.org/edcenter/disimpactmngmnt/topc/EcologyAndEpidemiologyInR/DiseaseProgress/PublishingImages/D1_E1.png#center)\n\nแสดงให้เห็นเป็นภาพจะเข้าใจได้ง่ายกว่า โดยจะให้ดู 2 package ที่สามารถคำนวนค่า AUDPC ได้\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   1.0.1 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.3.0      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 1.0.0 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(patchwork)\nlibrary(ggthemes)\nlibrary(rmarkdown)\ntheme_set(theme_few())\nknitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)\noptions(digits = 3)\n```\n:::\n\n\nสำหรับ agricolae นั้น มีสอนเกี่ยวกับ AUDPC ด้วย ด้วยคำสั่งข้างล่างนี้\n\n\n\n\nกราฟตัวอย่างการหา AUDPC\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/audpc graph-1.png){width=672}\n:::\n:::\n\n\nเมื่อมาคิด AUDPC โดยแบ่งพื้นที่ใต้กราฟออกเป็นช่วง จะได้ พื้นที้ สี่เหลี่ยม A และ B ตามรูป\nและ AUDPC = A + B ของโรคในช่วงเวลา 14 ถึง 21 วัน หรือจะคำนวนของเป็นค่า Relative AUDPC นำมาหารกับพื้นที่ทั้งหมด จากรูปคือกรอบสีเขียวทั้งหมด\n\nการคำนวนค่า AUDPC นั้น มีหลาย package ที่สามารถหาค่า AUDPC แต่ ลักษณะการใช้งานนั้นแตกต่างกัน ซึ่ง จะนำเสนอ 2 package คือ `agricolae` และ `epifitter`\n\n## agricolae::audpc()\n เป็น package สายที่ใช้วิเคราะหื สถิติการเกษตร ไว้ค่อนข้างครบถ้วน แต่ครั้งนี้ จะเน้นไปได้ function `audpc()`\n\n### ตัวอย่างข้อมูล และ functions\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\ndata(disease)\ndisease\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   plots rep trt E2 E5 E7 yield\n1    101   1  T1  4  9 10    16\n2    102   1  T2  3  6  7    11\n3    103   1  T3  3  4  6    24\n4    104   1  T4  0  0  2    27\n5    105   1  T5  0  0  2    28\n6    106   1  T6  2  2  4    23\n7    107   1  T0  7 14 23    11\n8    201   2  T1  6 12 14    14\n9    202   2  T2  3  7 14    18\n10   203   2  T3  2  3  5    26\n11   204   2  T4  2  4  8    15\n12   205   2  T5  0  0  2    26\n13   206   2  T6  1  2  4    14\n14   207   2  T0  6 16 21    12\n15   301   3  T1  7  8 12    14\n16   302   3  T2  8 11 14    16\n17   303   3  T3  3  5 13    10\n18   304   3  T4  5 12 15    11\n19   305   3  T5  2  9 15    10\n20   306   3  T6  3  6 12    11\n21   307   3  T0 11 21 35     8\n```\n:::\n\n```{.r .cell-code}\npaged_table(disease)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"plots\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"rep\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"trt\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"E2\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"E5\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"E7\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"yield\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"101\",\"2\":\"1\",\"3\":\"T1\",\"4\":\"4\",\"5\":\"9\",\"6\":\"10\",\"7\":\"16\",\"_rn_\":\"1\"},{\"1\":\"102\",\"2\":\"1\",\"3\":\"T2\",\"4\":\"3\",\"5\":\"6\",\"6\":\"7\",\"7\":\"11\",\"_rn_\":\"2\"},{\"1\":\"103\",\"2\":\"1\",\"3\":\"T3\",\"4\":\"3\",\"5\":\"4\",\"6\":\"6\",\"7\":\"24\",\"_rn_\":\"3\"},{\"1\":\"104\",\"2\":\"1\",\"3\":\"T4\",\"4\":\"0\",\"5\":\"0\",\"6\":\"2\",\"7\":\"27\",\"_rn_\":\"4\"},{\"1\":\"105\",\"2\":\"1\",\"3\":\"T5\",\"4\":\"0\",\"5\":\"0\",\"6\":\"2\",\"7\":\"28\",\"_rn_\":\"5\"},{\"1\":\"106\",\"2\":\"1\",\"3\":\"T6\",\"4\":\"2\",\"5\":\"2\",\"6\":\"4\",\"7\":\"23\",\"_rn_\":\"6\"},{\"1\":\"107\",\"2\":\"1\",\"3\":\"T0\",\"4\":\"7\",\"5\":\"14\",\"6\":\"23\",\"7\":\"11\",\"_rn_\":\"7\"},{\"1\":\"201\",\"2\":\"2\",\"3\":\"T1\",\"4\":\"6\",\"5\":\"12\",\"6\":\"14\",\"7\":\"14\",\"_rn_\":\"8\"},{\"1\":\"202\",\"2\":\"2\",\"3\":\"T2\",\"4\":\"3\",\"5\":\"7\",\"6\":\"14\",\"7\":\"18\",\"_rn_\":\"9\"},{\"1\":\"203\",\"2\":\"2\",\"3\":\"T3\",\"4\":\"2\",\"5\":\"3\",\"6\":\"5\",\"7\":\"26\",\"_rn_\":\"10\"},{\"1\":\"204\",\"2\":\"2\",\"3\":\"T4\",\"4\":\"2\",\"5\":\"4\",\"6\":\"8\",\"7\":\"15\",\"_rn_\":\"11\"},{\"1\":\"205\",\"2\":\"2\",\"3\":\"T5\",\"4\":\"0\",\"5\":\"0\",\"6\":\"2\",\"7\":\"26\",\"_rn_\":\"12\"},{\"1\":\"206\",\"2\":\"2\",\"3\":\"T6\",\"4\":\"1\",\"5\":\"2\",\"6\":\"4\",\"7\":\"14\",\"_rn_\":\"13\"},{\"1\":\"207\",\"2\":\"2\",\"3\":\"T0\",\"4\":\"6\",\"5\":\"16\",\"6\":\"21\",\"7\":\"12\",\"_rn_\":\"14\"},{\"1\":\"301\",\"2\":\"3\",\"3\":\"T1\",\"4\":\"7\",\"5\":\"8\",\"6\":\"12\",\"7\":\"14\",\"_rn_\":\"15\"},{\"1\":\"302\",\"2\":\"3\",\"3\":\"T2\",\"4\":\"8\",\"5\":\"11\",\"6\":\"14\",\"7\":\"16\",\"_rn_\":\"16\"},{\"1\":\"303\",\"2\":\"3\",\"3\":\"T3\",\"4\":\"3\",\"5\":\"5\",\"6\":\"13\",\"7\":\"10\",\"_rn_\":\"17\"},{\"1\":\"304\",\"2\":\"3\",\"3\":\"T4\",\"4\":\"5\",\"5\":\"12\",\"6\":\"15\",\"7\":\"11\",\"_rn_\":\"18\"},{\"1\":\"305\",\"2\":\"3\",\"3\":\"T5\",\"4\":\"2\",\"5\":\"9\",\"6\":\"15\",\"7\":\"10\",\"_rn_\":\"19\"},{\"1\":\"306\",\"2\":\"3\",\"3\":\"T6\",\"4\":\"3\",\"5\":\"6\",\"6\":\"12\",\"7\":\"11\",\"_rn_\":\"20\"},{\"1\":\"307\",\"2\":\"3\",\"3\":\"T0\",\"4\":\"11\",\"5\":\"21\",\"6\":\"35\",\"7\":\"8\",\"_rn_\":\"21\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\nจะเห็นว่าการบันถึงค่าความรุนแรงของโรคนั้น อยู่ใน column E2 E4 E7 ซึ่ง เป็นการประเมินโรค ครั้งที่ 1 2 และ 3 ก็ผมก็ไม่แน่ใจเหมือนกันว่า E2 คือการประเมิน วันที่ 2 หรือเปล่า ถ้าอยากลองหาอ่านดูว่า dataset `disease` นี้เป็นยังไงก็ `?disease` ดู\n\nผมลองทำกราฟจาก `disease` นี้ให้ดู\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_disease <- disease %>% gather(key = \"E_at\", value = \"disease_incidence\", -plots, -rep, -trt, -yield)\n\ntidy_disease %>% ggplot(aes(x = E_at, y = disease_incidence, color = trt, group = plots)) +\n  geom_point() + geom_line() + theme_light()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nกราฟนี้ยังไม่ถูกต้องนะครับ เพระาว่า แกน  X นั้น ไม่ใช่ เวลา แต่แค่จะแสดงออกมาเป็นกราฟให้่ดู ซึ่งในแต่ละ `trt` แบ่งเป็นสีต่าง ๆ และในแต่ละ `trt` มี ซ้ำ เราไม่อาจหาค่าเฉลี่ยของการประเมินได้นะครับ เพราะว่า ตัวอย่างนั้น แยกออกจากกัน ดังนั้นเวลาลากเส้นการพัฒนาของโรค จะต้องลากจากจุดแต่จุดในแต่ละซ้ำ\n\nต่อมาดูการหาค่า AUDPC นะครับ\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndates <- c(1, 2, 3) # week\nevaluation <- disease[, c(\"E2\", \"E5\", \"E7\")]\n# absolute AUDPC\naudpc(evaluation, dates, type = \"absolute\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 16.0 11.0  8.5  1.0  1.0  5.0 29.0 22.0 15.5  6.5  9.0  1.0  4.5 29.5 17.5\n[16] 22.0 13.0 22.0 17.5 13.5 44.0\n```\n:::\n\n```{.r .cell-code}\n# relative AUDPC\naudpc(evaluation, dates, type = \"relative\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.0800 0.0550 0.0425 0.0050 0.0050 0.0250 0.1450 0.1100 0.0775 0.0325\n[11] 0.0450 0.0050 0.0225 0.1475 0.0875 0.1100 0.0650 0.1100 0.0875 0.0675\n[21] 0.2200\n```\n:::\n\n```{.r .cell-code}\nrlt_audpc <- audpc(evaluation, dates, type = \"relative\")\n```\n:::\n\nลองเชคดูว่า มี AUDPC มีความสัมพันธ์กับผลผลิตหรือไม่\n\n::: {.cell}\n\n```{.r .cell-code}\n# Correlation between the yield and audpc\ncorrelation(disease$yield, rlt_audpc, method = \"kendall\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nKendall's rank correlation tau\n\ndata: disease$yield and rlt_audpc \nz-norm =  -3.33 p-value = 0.000878 \nalternative hypothesis: true rho is not equal to 0\nsample estimates:\ntau\n -0.544 \n```\n:::\n:::\n\n\n## epifitter::AUDPC()\nต่อมาเป็น library ใหม อย่าง [`epifitter`](https://openplantpathology.org/posts/2021-03-06-epifitter-a-tool-for-analysing-plant-disease-epidemics/) มี functions ที่หลากหลายมาก ที่ใช้การศึกษาด้านระบาดวิทยาโรคพืช\n\n### ตัวอย่างข้อมูล และ functions\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary('epifitter')\npepper <-\n  tibble::tribble(\n    ~time, ~var1, ~var2, ~var3,\n    0, 0.08, 0.001, 0.001,\n    7, 0.13, 0.01, 0.001,\n    14, 0.78, 0.09, 0.01,\n    21, 0.92, 0.25, 0.05,\n    28, 0.99, 0.8, 0.18,\n    35, 0.995, 0.98, 0.34,\n    42, 0.999, 0.99, 0.48,\n    49, 0.999, 0.999, 0.74\n  )\npaged_table(pepper)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"time\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"var1\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"var2\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"var3\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"0.080\",\"3\":\"0.001\",\"4\":\"0.001\"},{\"1\":\"7\",\"2\":\"0.130\",\"3\":\"0.010\",\"4\":\"0.001\"},{\"1\":\"14\",\"2\":\"0.780\",\"3\":\"0.090\",\"4\":\"0.010\"},{\"1\":\"21\",\"2\":\"0.920\",\"3\":\"0.250\",\"4\":\"0.050\"},{\"1\":\"28\",\"2\":\"0.990\",\"3\":\"0.800\",\"4\":\"0.180\"},{\"1\":\"35\",\"2\":\"0.995\",\"3\":\"0.980\",\"4\":\"0.340\"},{\"1\":\"42\",\"2\":\"0.999\",\"3\":\"0.990\",\"4\":\"0.480\"},{\"1\":\"49\",\"2\":\"0.999\",\"3\":\"0.999\",\"4\":\"0.740\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\nจะเห็นว่า โครงสร้างข้อมูล มีความแตกต่างกับการเอาไปใช้กับ function `audpc()` ข้างต้นครับ โดย ลำดับการประเมินโรค อยู่ใน column time และ ความรุนแรงของโรคของพันธู์ var1 อยู่ใน column var1\nดังนั้น จะใช้ functions ไหน ก็เรียงโครงสร้าง dataset ให้ถูกก่อน ถึงจะใช้ได้นะครับ อันนี้สำคัญ 🌟🌟🌟\nลองมาดูกราฟกัน\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(pepper, aes(time, var1)) +\n  geom_point() +\n  geom_line() +\n  theme_light() +\n  ylab(\"Disease severity\") +\n  xlab(\"Time (day)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAUDPC(time = pepper$time, y = pepper$var1, y_proportion = TRUE, type = \"absolute\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 37.5\n```\n:::\n\n```{.r .cell-code}\nAUDPC(time = pepper$time, y = pepper$var1, y_proportion = TRUE, type = \"relative\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.765\n```\n:::\n\n```{.r .cell-code}\nAUDPS(time = pepper$time, y = pepper$var1, y_proportion = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 41.3\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}