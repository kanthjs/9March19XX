{
  "hash": "abc94b698023c512f8488d17b1983bc4",
  "result": {
    "markdown": "---\ntitle: \"Area Under Disease progress Curve\"\ndate: '2021-11-15'\ncategories: [R, PDE]\ndraft: false\n---\n\n\n# AUDPC คือ อะไร\n\nพื้นที่ใต้กราฟกาพัฒนาของโรค (Area Under Disease progress Curve: AUDPC) ต่อจากนี้จะ พูดสั้น ๆ ว่า **พื้นที่ใต้กราฟ** หรือ **AUDPC** เป็นข้อมูลสรุปเชิงปริมาณ (ข้อย้ำว่าเป็นข้อมูลสรุป เพราะว่า 1 กราฟ มีแค่ค่าเดียว) ใช้เพื่อบ่งปริมาณของความรุนแรงของโรคในช่วงเวลาหนึ่งเพื่อเปรียบเทียบ ช่วงเวลาหนึ่ง ๆ เช่น ฤดู ปี สถานที่ หรือ วิธีการจัดการ\n\nวิธีการที่ใช้บ่อยที่สุดในการประมาณค่า AUDPC คือการแยกคิดพื้นที่ใต้กราฟเป็นช่วง ๆ ซึ่งสามารถพิจารณาจุดเวลาในลำดับ $$t_{i}$$ โดยที่ช่วงเวลาระหว่างจุดเวลาสองจุดอาจสอดคล้องกันหรืออาจแตกต่างกันไป ที่ค่าความเกิดหรือความรุนแรงของโรคที่เวลาหนึ่ง ๆ $y_{i}$ เรากำหนด ความรุนแรงของโรคที่เวลา 0 กำหนด $$y_{0}$$ ที่เวลา $$t_{0}$$ ซึ่งคือ การสังเกตความรุนแรงของโรคครั้งแรกในการศึกษาของเรา A (tk) AUDPC ที่ $$t = t_{k}$$ คือค่าการสะสมของโรคทั้่งหมดจนถึงเวลา $$t_{k}$$ ที่กำหนด โดยตามสูตรคณิตศาสตร์ ![](https://www.apsnet.org/edcenter/disimpactmngmnt/topc/EcologyAndEpidemiologyInR/DiseaseProgress/PublishingImages/D1_E1.png#center)\n\nแสดงให้เห็นเป็นภาพจะเข้าใจได้ง่ายกว่า โดยจะให้ดู 2 package ที่สามารถคำนวนค่า AUDPC ได้\n\n\n::: {.cell}\n\n:::\n\n\nสำหรับ agricolae นั้น มีสอนเกี่ยวกับ AUDPC ด้วย ด้วยคำสั่งข้างล่างนี้\n\n\n\n\n\nกราฟตัวอย่างการหา AUDPC\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/audpc graph-1.png){width=672}\n:::\n:::\n\n\nเมื่อมาคิด AUDPC โดยแบ่งพื้นที่ใต้กราฟออกเป็นช่วง จะได้ พื้นที้ สี่เหลี่ยม A และ B ตามรูป และ AUDPC = A + B ของโรคในช่วงเวลา 14 ถึง 21 วัน หรือจะคำนวนของเป็นค่า Relative AUDPC นำมาหารกับพื้นที่ทั้งหมด จากรูปคือกรอบสีเขียวทั้งหมด\n\nการคำนวนค่า AUDPC นั้น มีหลาย package ที่สามารถหาค่า AUDPC แต่ ลักษณะการใช้งานนั้นแตกต่างกัน ซึ่ง จะนำเสนอ 2 package คือ `agricolae` และ `epifitter`\n\n## agricolae::audpc()\n\nเป็น package สายที่ใช้วิเคราะหื สถิติการเกษตร ไว้ค่อนข้างครบถ้วน แต่ครั้งนี้ จะเน้นไปได้ function `audpc()`\n\n### ตัวอย่างข้อมูล และ functions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\ndata(disease)\ndisease\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| plots| rep|trt | E2| E5| E7| yield|\n|-----:|---:|:---|--:|--:|--:|-----:|\n|   101|   1|T1  |  4|  9| 10|    16|\n|   102|   1|T2  |  3|  6|  7|    11|\n|   103|   1|T3  |  3|  4|  6|    24|\n|   104|   1|T4  |  0|  0|  2|    27|\n|   105|   1|T5  |  0|  0|  2|    28|\n|   106|   1|T6  |  2|  2|  4|    23|\n|   107|   1|T0  |  7| 14| 23|    11|\n|   201|   2|T1  |  6| 12| 14|    14|\n|   202|   2|T2  |  3|  7| 14|    18|\n|   203|   2|T3  |  2|  3|  5|    26|\n|   204|   2|T4  |  2|  4|  8|    15|\n|   205|   2|T5  |  0|  0|  2|    26|\n|   206|   2|T6  |  1|  2|  4|    14|\n|   207|   2|T0  |  6| 16| 21|    12|\n|   301|   3|T1  |  7|  8| 12|    14|\n|   302|   3|T2  |  8| 11| 14|    16|\n|   303|   3|T3  |  3|  5| 13|    10|\n|   304|   3|T4  |  5| 12| 15|    11|\n|   305|   3|T5  |  2|  9| 15|    10|\n|   306|   3|T6  |  3|  6| 12|    11|\n|   307|   3|T0  | 11| 21| 35|     8|\n\n</div>\n:::\n\n```{.r .cell-code}\npaged_table(disease)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| plots| rep|trt | E2| E5| E7| yield|\n|-----:|---:|:---|--:|--:|--:|-----:|\n|   101|   1|T1  |  4|  9| 10|    16|\n|   102|   1|T2  |  3|  6|  7|    11|\n|   103|   1|T3  |  3|  4|  6|    24|\n|   104|   1|T4  |  0|  0|  2|    27|\n|   105|   1|T5  |  0|  0|  2|    28|\n|   106|   1|T6  |  2|  2|  4|    23|\n|   107|   1|T0  |  7| 14| 23|    11|\n|   201|   2|T1  |  6| 12| 14|    14|\n|   202|   2|T2  |  3|  7| 14|    18|\n|   203|   2|T3  |  2|  3|  5|    26|\n|   204|   2|T4  |  2|  4|  8|    15|\n|   205|   2|T5  |  0|  0|  2|    26|\n|   206|   2|T6  |  1|  2|  4|    14|\n|   207|   2|T0  |  6| 16| 21|    12|\n|   301|   3|T1  |  7|  8| 12|    14|\n|   302|   3|T2  |  8| 11| 14|    16|\n|   303|   3|T3  |  3|  5| 13|    10|\n|   304|   3|T4  |  5| 12| 15|    11|\n|   305|   3|T5  |  2|  9| 15|    10|\n|   306|   3|T6  |  3|  6| 12|    11|\n|   307|   3|T0  | 11| 21| 35|     8|\n\n</div>\n:::\n:::\n\n\nจะเห็นว่าการบันถึงค่าความรุนแรงของโรคนั้น อยู่ใน column E2 E4 E7 ซึ่ง เป็นการประเมินโรค ครั้งที่ 1 2 และ 3 ก็ผมก็ไม่แน่ใจเหมือนกันว่า E2 คือการประเมิน วันที่ 2 หรือเปล่า ถ้าอยากลองหาอ่านดูว่า dataset `disease` นี้เป็นยังไงก็ `?disease` ดู\n\nผมลองทำกราฟจาก `disease` นี้ให้ดู\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_disease <- disease %>% gather(key = \"E_at\", value = \"disease_incidence\", -plots, -rep, -trt, -yield)\n\ntidy_disease %>% ggplot(aes(x = E_at, y = disease_incidence, color = trt, group = plots)) +\n  geom_point() + geom_line() + theme_light()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nกราฟนี้ยังไม่ถูกต้องนะครับ เพระาว่า แกน X นั้น ไม่ใช่ เวลา แต่แค่จะแสดงออกมาเป็นกราฟให้่ดู ซึ่งในแต่ละ `trt` แบ่งเป็นสีต่าง ๆ และในแต่ละ `trt` มี ซ้ำ เราไม่อาจหาค่าเฉลี่ยของการประเมินได้นะครับ เพราะว่า ตัวอย่างนั้น แยกออกจากกัน ดังนั้นเวลาลากเส้นการพัฒนาของโรค จะต้องลากจากจุดแต่จุดในแต่ละซ้ำ\n\nต่อมาดูการหาค่า AUDPC นะครับ\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndates <- c(1, 2, 3) # week\nevaluation <- disease[, c(\"E2\", \"E5\", \"E7\")]\n# absolute AUDPC\naudpc(evaluation, dates, type = \"absolute\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 16.0 11.0  8.5  1.0  1.0  5.0 29.0 22.0 15.5  6.5  9.0  1.0  4.5 29.5 17.5\n[16] 22.0 13.0 22.0 17.5 13.5 44.0\n```\n:::\n\n```{.r .cell-code}\n# relative AUDPC\naudpc(evaluation, dates, type = \"relative\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.0800 0.0550 0.0425 0.0050 0.0050 0.0250 0.1450 0.1100 0.0775 0.0325\n[11] 0.0450 0.0050 0.0225 0.1475 0.0875 0.1100 0.0650 0.1100 0.0875 0.0675\n[21] 0.2200\n```\n:::\n\n```{.r .cell-code}\nrlt_audpc <- audpc(evaluation, dates, type = \"relative\")\n```\n:::\n\n\nลองเชคดูว่า มี AUDPC มีความสัมพันธ์กับผลผลิตหรือไม่\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Correlation between the yield and audpc\ncorrelation(disease$yield, rlt_audpc, method = \"kendall\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nKendall's rank correlation tau\n\ndata: disease$yield and rlt_audpc \nz-norm =  -3.33 p-value = 0.000878 \nalternative hypothesis: true rho is not equal to 0\nsample estimates:\ntau\n -0.544 \n```\n:::\n:::\n\n\n## epifitter::AUDPC()\n\nต่อมาเป็น library ใหม อย่าง [`epifitter`](https://openplantpathology.org/posts/2021-03-06-epifitter-a-tool-for-analysing-plant-disease-epidemics/) มี functions ที่หลากหลายมาก ที่ใช้การศึกษาด้านระบาดวิทยาโรคพืช\n\n### ตัวอย่างข้อมูล และ functions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary('epifitter')\npepper <-\n  tibble::tribble(\n    ~time, ~var1, ~var2, ~var3,\n    0, 0.08, 0.001, 0.001,\n    7, 0.13, 0.01, 0.001,\n    14, 0.78, 0.09, 0.01,\n    21, 0.92, 0.25, 0.05,\n    28, 0.99, 0.8, 0.18,\n    35, 0.995, 0.98, 0.34,\n    42, 0.999, 0.99, 0.48,\n    49, 0.999, 0.999, 0.74\n  )\npaged_table(pepper)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| time|  var1|  var2|  var3|\n|----:|-----:|-----:|-----:|\n|    0| 0.080| 0.001| 0.001|\n|    7| 0.130| 0.010| 0.001|\n|   14| 0.780| 0.090| 0.010|\n|   21| 0.920| 0.250| 0.050|\n|   28| 0.990| 0.800| 0.180|\n|   35| 0.995| 0.980| 0.340|\n|   42| 0.999| 0.990| 0.480|\n|   49| 0.999| 0.999| 0.740|\n\n</div>\n:::\n:::\n\n\nจะเห็นว่า โครงสร้างข้อมูล มีความแตกต่างกับการเอาไปใช้กับ function `audpc()` ข้างต้นครับ โดย ลำดับการประเมินโรค อยู่ใน column time และ ความรุนแรงของโรคของพันธู์ var1 อยู่ใน column var1 ดังนั้น จะใช้ functions ไหน ก็เรียงโครงสร้าง dataset ให้ถูกก่อน ถึงจะใช้ได้นะครับ อันนี้สำคัญ 🌟🌟🌟 ลองมาดูกราฟกัน\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(pepper, aes(time, var1)) +\n  geom_point() +\n  geom_line() +\n  theme_light() +\n  ylab(\"Disease severity\") +\n  xlab(\"Time (day)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAUDPC(time = pepper$time, y = pepper$var1, y_proportion = TRUE, type = \"absolute\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 37.5\n```\n:::\n\n```{.r .cell-code}\nAUDPC(time = pepper$time, y = pepper$var1, y_proportion = TRUE, type = \"relative\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.765\n```\n:::\n\n```{.r .cell-code}\nAUDPS(time = pepper$time, y = pepper$var1, y_proportion = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 41.3\n```\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}